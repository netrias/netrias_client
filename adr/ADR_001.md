# ADR 001: Data Model Store API Integration

## Status
Accepted

## Context
The Netrias client provides discovery and harmonization workflows for data transformation. A common downstream use case is **validation**: checking whether values in a dataset match the permissible values (PVs) defined for a given Common Data Element (CDE) within a data model.

The Data Model Store API exposes reference data:
- Data models (data commons)
- CDEs within model versions
- Permissible values for each CDE

Previously, callers had no programmatic way to query this reference data through the client.

## Decision
Integrate the Data Model Store API directly into `NetriasClient` rather than creating a separate client class.

Key design choices:

1. **Single client surface**: Add methods to `NetriasClient` to maintain a unified API for all Netrias services. Callers configure once and access discovery, harmonization, and validation through the same instance.

2. **Async-first with sync wrappers**: Follow the existing pattern where async methods are primary and sync wrappers use `asyncio.run()`. This keeps the codebase consistent and allows callers to choose their preferred style.

3. **Endpoint encapsulation**: Introduce `DataModelStoreEndpoints` dataclass containing only `base_url`. This isolates endpoint configuration for future swappability when temporary endpoints are replaced.

4. **Validation convenience methods**: Provide `get_pv_set()` returning `frozenset[str]` for O(1) membership testing, and `validate_value()` as a one-liner for simple validation checks. The `get_pv_set()` function auto-paginates to hide API pagination details from callers.

5. **No caching**: Let callers decide caching strategy. The client fetches fresh data on each call, enabling callers to implement their own caching policies based on their consistency requirements.

6. **URL path encoding**: Use `urllib.parse.quote()` for all path parameters to prevent injection and handle special characters in model keys, versions, and CDE keys.

## Consequences

**Benefits:**
- Unified client API reduces cognitive overhead
- Consistent async/sync pattern across all operations
- Callers can validate data against authoritative PV sets
- Endpoint swappability supports future API changes

**Trade-offs:**
- No built-in caching means repeated calls hit the API; callers must implement caching if needed
- `NetriasClient` grows larger; acceptable given the cohesive domain

**Future considerations:**
- When temporary endpoints are retired, update `DATA_MODEL_STORE_BASE_URL` and potentially add version-specific endpoint configuration
- Consider adding batch validation methods if callers need to validate many values efficiently
